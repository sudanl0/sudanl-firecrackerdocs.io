<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Trait for file descriptors can send and receive socket control messages via `sendmsg` and `recvmsg`."><title>ScmSocket in utils::sock_ctrl_msg - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="utils" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../utils/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../utils/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">ScmSocket</a></h2><div class="sidebar-elems"><section><h3><a href="#required-methods">Required Methods</a></h3><ul class="block"><li><a href="#tymethod.socket_fd">socket_fd</a></li></ul><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.recv_with_fd">recv_with_fd</a></li><li><a href="#method.recv_with_fds">recv_with_fds</a></li><li><a href="#method.send_with_fd">send_with_fd</a></li><li><a href="#method.send_with_fds">send_with_fds</a></li></ul><h3><a href="#foreign-impls">Implementations on Foreign Types</a></h3><ul class="block"><li><a href="#impl-ScmSocket-for-UnixDatagram">UnixDatagram</a></li><li><a href="#impl-ScmSocket-for-UnixStream">UnixStream</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In utils::sock_ctrl_msg</a></h2></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">utils</a>::<wbr><a href="index.html">sock_ctrl_msg</a>::<wbr><a class="trait" href="#">ScmSocket</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait ScmSocket {
    // Required method
    fn <a href="#tymethod.socket_fd" class="fn">socket_fd</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>;

    // Provided methods
    fn <a href="#method.send_with_fd" class="fn">send_with_fd</a>&lt;D&gt;(&amp;self, buf: D, fd: <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;
       <span class="where">where D: <a class="trait" href="trait.IntoIovec.html" title="trait utils::sock_ctrl_msg::IntoIovec">IntoIovec</a></span> { ... }
<span class="item-spacer"></span>    fn <a href="#method.send_with_fds" class="fn">send_with_fds</a>&lt;D&gt;(&amp;self, bufs: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.slice.html">[D]</a>, fds: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>]) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;
       <span class="where">where D: <a class="trait" href="trait.IntoIovec.html" title="trait utils::sock_ctrl_msg::IntoIovec">IntoIovec</a></span> { ... }
<span class="item-spacer"></span>    fn <a href="#method.recv_with_fd" class="fn">recv_with_fd</a>(
        &amp;self,
        buf: &amp;mut [<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.u8.html">u8</a>]
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.73.0/std/fs/struct.File.html" title="struct std::fs::File">File</a>&gt;), <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt; { ... }
<span class="item-spacer"></span>    unsafe fn <a href="#method.recv_with_fds" class="fn">recv_with_fds</a>(
        &amp;self,
        iovecs: &amp;mut [iovec],
        fds: &amp;mut [<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>]
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>), <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt; { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Trait for file descriptors can send and receive socket control messages via <code>sendmsg</code> and
<code>recvmsg</code>.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">extern crate </span>vmm_sys_util;
<span class="kw">use </span>vmm_sys_util::sock_ctrl_msg::ScmSocket;


<span class="kw">let </span>(s1, s2) = UnixDatagram::pair().expect(<span class="string">&quot;failed to create socket pair&quot;</span>);
<span class="kw">let </span>evt = EventFd::new(<span class="number">0</span>).expect(<span class="string">&quot;failed to create eventfd&quot;</span>);

<span class="kw">let </span>write_count = s1
    .send_with_fds(<span class="kw-2">&amp;</span>[[<span class="number">237</span>].as_ref()], <span class="kw-2">&amp;</span>[evt.as_raw_fd()])
    .expect(<span class="string">&quot;failed to send fd&quot;</span>);

<span class="kw">let </span><span class="kw-2">mut </span>files = [<span class="number">0</span>; <span class="number">2</span>];
<span class="kw">let </span><span class="kw-2">mut </span>buf = [<span class="number">0u8</span>];
<span class="kw">let </span><span class="kw-2">mut </span>iovecs = [iovec {
    iov_base: buf.as_mut_ptr() <span class="kw">as </span><span class="kw-2">*mut </span>c_void,
    iov_len: buf.len(),
}];
<span class="kw">let </span>(read_count, file_count) = <span class="kw">unsafe </span>{
    s2.recv_with_fds(<span class="kw-2">&amp;mut </span>iovecs[..], <span class="kw-2">&amp;mut </span>files)
        .expect(<span class="string">&quot;failed to recv fd&quot;</span>)
};

<span class="kw">let </span><span class="kw-2">mut </span>file = <span class="kw">unsafe </span>{ File::from_raw_fd(files[<span class="number">0</span>]) };
file.write(<span class="kw">unsafe </span>{ from_raw_parts(<span class="kw-2">&amp;</span><span class="number">1203u64 </span><span class="kw">as </span><span class="kw-2">*const </span>u64 <span class="kw">as </span><span class="kw-2">*const </span>u8, <span class="number">8</span>) })
    .expect(<span class="string">&quot;failed to write to sent fd&quot;</span>);
<span class="macro">assert_eq!</span>(evt.read().expect(<span class="string">&quot;failed to read from eventfd&quot;</span>), <span class="number">1203</span>);</code></pre></div>
</div></details><h2 id="required-methods" class="small-section-header">Required Methods<a href="#required-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="tymethod.socket_fd" class="method"><h4 class="code-header">fn <a href="#tymethod.socket_fd" class="fn">socket_fd</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a></h4></section></summary><div class="docblock"><p>Gets the file descriptor of this socket.</p>
</div></details></div><h2 id="provided-methods" class="small-section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.send_with_fd" class="method"><h4 class="code-header">fn <a href="#method.send_with_fd" class="fn">send_with_fd</a>&lt;D&gt;(&amp;self, buf: D, fd: <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;<span class="where fmt-newline">where
    D: <a class="trait" href="trait.IntoIovec.html" title="trait utils::sock_ctrl_msg::IntoIovec">IntoIovec</a>,</span></h4></section></summary><div class="docblock"><p>Sends the given data and file descriptor over the socket.</p>
<p>On success, returns the number of bytes sent.</p>
<h5 id="arguments"><a href="#arguments">Arguments</a></h5>
<ul>
<li><code>buf</code> - A buffer of data to send on the <code>socket</code>.</li>
<li><code>fd</code> - A file descriptors to be sent.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.send_with_fds" class="method"><h4 class="code-header">fn <a href="#method.send_with_fds" class="fn">send_with_fds</a>&lt;D&gt;(&amp;self, bufs: &amp;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.slice.html">[D]</a>, fds: &amp;[<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>]) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;<span class="where fmt-newline">where
    D: <a class="trait" href="trait.IntoIovec.html" title="trait utils::sock_ctrl_msg::IntoIovec">IntoIovec</a>,</span></h4></section></summary><div class="docblock"><p>Sends the given data and file descriptors over the socket.</p>
<p>On success, returns the number of bytes sent.</p>
<h5 id="arguments-1"><a href="#arguments-1">Arguments</a></h5>
<ul>
<li><code>bufs</code> - A list of data buffer to send on the <code>socket</code>.</li>
<li><code>fds</code> - A list of file descriptors to be sent.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.recv_with_fd" class="method"><h4 class="code-header">fn <a href="#method.recv_with_fd" class="fn">recv_with_fd</a>(&amp;self, buf: &amp;mut [<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.u8.html">u8</a>]) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;<a class="struct" href="https://doc.rust-lang.org/1.73.0/std/fs/struct.File.html" title="struct std::fs::File">File</a>&gt;), <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;</h4></section></summary><div class="docblock"><p>Receives data and potentially a file descriptor from the socket.</p>
<p>On success, returns the number of bytes and an optional file descriptor.</p>
<h5 id="arguments-2"><a href="#arguments-2">Arguments</a></h5>
<ul>
<li><code>buf</code> - A buffer to receive data from the socket.</li>
</ul>
</div></details><details class="toggle method-toggle" open><summary><section id="method.recv_with_fds" class="method"><h4 class="code-header">unsafe fn <a href="#method.recv_with_fds" class="fn">recv_with_fds</a>(
    &amp;self,
    iovecs: &amp;mut [iovec],
    fds: &amp;mut [<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a>]
) -&gt; <a class="enum" href="https://doc.rust-lang.org/1.73.0/core/result/enum.Result.html" title="enum core::result::Result">Result</a>&lt;(<a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>, <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.usize.html">usize</a>), <a class="struct" href="../errno/struct.Error.html" title="struct utils::errno::Error">Error</a>&gt;</h4></section></summary><div class="docblock"><p>Receives data and file descriptors from the socket.</p>
<p>On success, returns the number of bytes and file descriptors received as a tuple
<code>(bytes count, files count)</code>.</p>
<h5 id="arguments-3"><a href="#arguments-3">Arguments</a></h5>
<ul>
<li><code>iovecs</code> - A list of iovec to receive data from the socket.</li>
<li><code>fds</code> - A slice of <code>RawFd</code>s to put the received file descriptors into. On success, the
number of valid file descriptors is indicated by the second element of the
returned tuple. The caller owns these file descriptors, but they will not be
closed on drop like a <code>File</code>-like type would be. It is recommended that each valid
file descriptor gets wrapped in a drop type that closes it after this returns.</li>
</ul>
<h5 id="safety"><a href="#safety">Safety</a></h5>
<p>It is the callers responsibility to ensure it is safe for arbitrary data to be
written to the iovec pointers.</p>
</div></details></div><h2 id="foreign-impls" class="small-section-header">Implementations on Foreign Types<a href="#foreign-impls" class="anchor">§</a></h2><details class="toggle implementors-toggle"><summary><section id="impl-ScmSocket-for-UnixStream" class="impl"><a href="#impl-ScmSocket-for-UnixStream" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.ScmSocket.html" title="trait utils::sock_ctrl_msg::ScmSocket">ScmSocket</a> for <a class="struct" href="https://doc.rust-lang.org/1.73.0/std/os/unix/net/stream/struct.UnixStream.html" title="struct std::os::unix::net::stream::UnixStream">UnixStream</a></h3></section></summary><div class="impl-items"><section id="method.socket_fd" class="method trait-impl"><a href="#method.socket_fd" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.socket_fd" class="fn">socket_fd</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a></h4></section></div></details><details class="toggle implementors-toggle"><summary><section id="impl-ScmSocket-for-UnixDatagram" class="impl"><a href="#impl-ScmSocket-for-UnixDatagram" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.ScmSocket.html" title="trait utils::sock_ctrl_msg::ScmSocket">ScmSocket</a> for <a class="struct" href="https://doc.rust-lang.org/1.73.0/std/os/unix/net/datagram/struct.UnixDatagram.html" title="struct std::os::unix::net::datagram::UnixDatagram">UnixDatagram</a></h3></section></summary><div class="impl-items"><section id="method.socket_fd-1" class="method trait-impl"><a href="#method.socket_fd-1" class="anchor">§</a><h4 class="code-header">fn <a href="#tymethod.socket_fd" class="fn">socket_fd</a>(&amp;self) -&gt; <a class="primitive" href="https://doc.rust-lang.org/1.73.0/std/primitive.i32.html">i32</a></h4></section></div></details><h2 id="implementors" class="small-section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"></div><script src="../../implementors/vmm_sys_util/linux/sock_ctrl_msg/trait.ScmSocket.js" data-ignore-extern-crates="std" async></script></section></div></main></body></html>