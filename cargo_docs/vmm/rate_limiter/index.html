<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Rate Limiter"><title>vmm::rate_limiter - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-cb6f1f67f1bcd037.css" id="mainThemeStyle"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="vmm" data-themes="" data-resource-suffix="" data-rustdoc-version="1.73.0 (cc66ad468 2023-10-03)" data-channel="1.73.0" data-search-js="search-6dfdfced5eff6596.js" data-settings-js="settings-de11bff964e9d4e5.js" data-settings-css="settings-8c76f75bfb6bd192.css" data-theme-light-css="light-1596385f77d47ef2.css" data-theme-dark-css="dark-0a43001d3fc2282c.css" data-theme-ayu-css="ayu-fd19013d6ce078bf.css" ><script src="../../static.files/storage-db41da1a38ea3cb8.js"></script><script defer src="../../static.files/main-0795b7d26be81095.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../static.files/light-1596385f77d47ef2.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../static.files/dark-0a43001d3fc2282c.css"><link rel="stylesheet" href="../../static.files/noscript-cffde32267a19fd6.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../vmm/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../vmm/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module rate_limiter</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">vmm</a>::<wbr><a class="mod" href="#">rate_limiter</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="src" href="../../src/vmm/rate_limiter/mod.rs.html#4-1197">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="rate-limiter"><a href="#rate-limiter">Rate Limiter</a></h2>
<p>Provides a rate limiter written in Rust useful for IO operations that need to
be throttled.</p>
<h3 id="behavior"><a href="#behavior">Behavior</a></h3>
<p>The rate limiter starts off as ‘unblocked’ with two token buckets configured
with the values passed in the <code>RateLimiter::new()</code> constructor.
All subsequent accounting is done independently for each token bucket based
on the <code>TokenType</code> used. If any of the buckets runs out of budget, the limiter
goes in the ‘blocked’ state. At this point an internal timer is set up which
will later ‘wake up’ the user in order to retry sending data. The ‘wake up’
notification will be dispatched as an event on the FD provided by the <code>AsRawFD</code>
trait implementation.</p>
<p>The contract is that the user shall also call the <code>event_handler()</code> method on
receipt of such an event.</p>
<p>The token buckets are replenished when a called <code>consume()</code> doesn’t find enough
tokens in the bucket. The amount of tokens replenished is automatically calculated
to respect the <code>complete_refill_time</code> configuration parameter provided by the user.
The token buckets will never replenish above their respective <code>size</code>.</p>
<p>Each token bucket can start off with a <code>one_time_burst</code> initial extra capacity
on top of their <code>size</code>. This initial extra credit does not replenish and
can be used for an initial burst of data.</p>
<p>The granularity for ‘wake up’ events when the rate limiter is blocked is
currently hardcoded to <code>100 milliseconds</code>.</p>
<h3 id="limitations"><a href="#limitations">Limitations</a></h3>
<p>This rate limiter implementation relies on the <em>Linux kernel’s timerfd</em> so its
usage is limited to Linux systems.</p>
<p>Another particularity of this implementation is that it is not self-driving.
It is meant to be used in an external event loop and thus implements the <code>AsRawFd</code>
trait and provides an <em>event-handler</em> as part of its API. This <em>event-handler</em>
needs to be called by the user on every event on the rate limiter’s <code>AsRawFd</code> FD.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><ul class="item-table"><li><div class="item-name"><a class="mod" href="persist/index.html" title="mod vmm::rate_limiter::persist">persist</a></div><div class="desc docblock-short">Defines the structures needed for saving/restoring a RateLimiter.</div></li></ul><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.RateLimiter.html" title="struct vmm::rate_limiter::RateLimiter">RateLimiter</a></div><div class="desc docblock-short">Rate Limiter that works on both bandwidth and ops/s limiting.</div></li><li><div class="item-name"><a class="struct" href="struct.TokenBucket.html" title="struct vmm::rate_limiter::TokenBucket">TokenBucket</a></div><div class="desc docblock-short">TokenBucket provides a lower level interface to rate limiting with a
configurable capacity, refill-rate and initial burst.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.BucketReduction.html" title="enum vmm::rate_limiter::BucketReduction">BucketReduction</a></div><div class="desc docblock-short">Enum describing the outcomes of a <code>reduce()</code> call on a <code>TokenBucket</code>.</div></li><li><div class="item-name"><a class="enum" href="enum.BucketUpdate.html" title="enum vmm::rate_limiter::BucketUpdate">BucketUpdate</a></div><div class="desc docblock-short">Enum that describes the type of token bucket update.</div></li><li><div class="item-name"><a class="enum" href="enum.Error.html" title="enum vmm::rate_limiter::Error">Error</a></div><div class="desc docblock-short">Describes the errors that may occur while handling rate limiter events.</div></li><li><div class="item-name"><a class="enum" href="enum.TokenType.html" title="enum vmm::rate_limiter::TokenType">TokenType</a></div><div class="desc docblock-short">Enum that describes the type of token used.</div></li></ul></section></div></main></body></html>